# アクセストークン取得方法

Graph APIのアクセストークンを取得するには、以下の手順が必要です。

## 1. Azure ADにアプリケーションを登録

- Azure ADポータルでアプリケーションを登録する[20]
- アプリケーションにクライアントIDとクライアントシークレットを設定する[5][17]
- アプリケーションに必要なアクセス許可(例: User.Read, Mail.Read)を設定する[14][18]

## 2. 認証フローを選択

Graph APIへのアクセスに適した認証フローを選択します。主なフローは以下の2つです。

- 認可コードフロー(Authorization Code Flow) - ユーザーの代わりにアクセスする場合[16][17]
- クライアントクレデンシャルフロー(Client Credentials Flow) - アプリ自身の権限でアクセスする場合[14]

## 3. アクセストークンをリクエスト

選択した認証フローに従って、トークンエンドポイントにリクエストを送信し、アクセストークンを取得します。

- 認可コードフローの場合は、認可エンドポイントにリダイレクトしてコードを取得した後、コードをトークンと交換[13][16]
- クライアントクレデンシャルフローの場合は、クライアントIDとクライアントシークレットを使ってトークンをリクエスト[9][14]

トークンエンドポイントへのリクエストでは、以下のパラメータを指定します。

- grant_type - 認証フローに応じて authorization_code または client_credentials
- client_id - アプリのクライアントID
- client_secret - アプリのクライアントシークレット
- scope - 必要なアクセス許可(例: https://graph.microsoft.com/.default) [14][18]

## 4. アクセストークンを使ってGraph APIを呼び出す

- 取得したアクセストークンをHTTPリクエストの Authorization ヘッダに設定して Graph APIを呼び出す[14][16]
- レスポンスからユーザー情報などの必要なデータを取得する

以上がGraph APIのアクセストークン取得の基本的な流れです。アプリの要件に合わせて適切な認証フローを選択し、トークンを安全に管理することが重要です。
